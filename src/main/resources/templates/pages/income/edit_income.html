<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layouts/default}"
>
  <head>
    <title>Expense Management</title>
    <style>
      .title-information {
        background-color: var(--bs-primary-border-subtle);
        color: var(--bs-primary-text-emphasis);
        border: none;
      }
    </style>
  </head>

  <body>
    <section layout:fragment="page">
      <div
        th:if="${error}"
        class="alert alert-danger alert-dismissible fade show"
        role="alert"
      >
        <strong>Error:</strong> <span th:text="${error}"></span>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
          aria-label="Close"
        ></button>
      </div>
      <form action="/income" method="POST">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h5 th:text="${title}" class="fw-bolder"></h5>
          <div>
            <button type="submit" class="btn btn-primary text-white">
              Save
            </button>
            <a href="/income" class="btn btn-outline-danger">Close</a>
          </div>
        </div>

        <div class="card border-0">
          <h6 class="card-header title-information">Income Information</h6>
          <div class="card-body">
            <!-- Business Name (Dropdown) -->
            <div class="mb-3">
              <label for="business" class="form-label">Business Name *</label>
              <select
                name="business_id"
                id="business"
                class="form-control form-select"
                required
              >
                <option value="">Select a Business</option>
                <option
                  th:each="business : ${businesses}"
                  th:value="${business.id}"
                  th:text="${business.name}"
                  th:selected="${income != null && income.business.id == business.id}"
                ></option>
              </select>
            </div>

            <!-- Balance Name (Dropdown) -->
            <div class="mb-3">
              <label for="balance" class="form-label">Balance Name *</label>
              <select
                name="balance_id"
                id="balance"
                class="form-control form-select"
                required
              >
                <option value="">Select a Balance</option>
                <option
                  th:each="balance : ${balances}"
                  th:value="${balance.id}"
                  th:text="${ balance.name + ' ( ' + balance.balanceFormatted + ' )' }"
                  th:selected="${income != null && income.balance.id == balance.id}"
                ></option>
              </select>
            </div>

            <!-- Category Name (Dropdown) -->
            <div class="mb-3">
              <label for="category" class="form-label">Category Name *</label>
              <select
                name="transactionCategory"
                id="category"
                class="form-control form-select"
                required
              >
                <option value="">Select a Category</option>
                <option
                  th:each="category : ${categories}"
                  th:value="${category}"
                  th:text="${category }"
                  th:selected="${income != null && income.transactionCategory == category}"
                  class="text-capitalize"
                ></option>
              </select>
            </div>

            <!-- Amount -->
            <div class="mb-3">
              <label for="amount" class="form-label">Amount ($) *</label>
              <input
                type="number"
                name="amount"
                id="amount"
                class="form-control"
                required
                th:value="${income != null ? income.amount : ''}"
                min="0.01"
                step="0.01"
              />
            </div>

            <!-- Date -->
            <div class="mb-3">
              <label for="notes" class="form-label">Date (yyyy-mm-dd) *</label>
              <div class="input-group">
                <input
                  type="date"
                  id="createdAt"
                  name="createdAt"
                  class="form-control"
                  required
                  th:value="${income != null ? income.getCreatedAtDate : ''}"
                />
                <span class="input-group-text" style="cursor: pointer">
                  <i class="bi bi-calendar4"></i>
                </span>
              </div>
            </div>

            <!-- Notes -->
            <div class="mb-3">
              <label for="notes" class="form-label">Notes</label>
              <textarea
                name="notes"
                id="notes"
                class="form-control"
                rows="3"
                th:text="${income != null ? income.notes : ''}"
              ></textarea>
            </div>

            <!-- Hidden Fields -->
            <input type="hidden" name="transactionType" value="Income" />
            <input
              type="hidden"
              name="id"
              th:value="${income != null ? income.id : ''}"
            />
          </div>
        </div>
      </form>
    </section>
  </body>
</html>

<!-- Initialize Flatpickr -->
<script>
  flatpickr("#createdAt", {});
</script>
